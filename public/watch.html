<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Agents - Watch</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #4ade80;
            font-size: 2.5em;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        .card {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 20px;
        }
        .card h2 {
            color: #4ade80;
            margin-bottom: 15px;
        }
        .leaderboard-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            padding: 10px;
            border-bottom: 1px solid #333;
        }
        .action-log {
            list-style: none;
            max-height: 500px;
            overflow-y: auto;
        }
        .action-item {
            padding: 10px;
            border-bottom: 1px solid #333;
            font-size: 0.9em;
        }
        .agent { color: #4ade80; font-weight: bold; }
        .action { color: #60a5fa; }
        .time { color: #888; font-size: 0.8em; }
        .result-win { color: #4ade80; }
        .result-loss { color: #f87171; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≤ Blackjack Agents Playground</h1>
        
        <div class="grid">
            <div class="card">
                <h2>üìä Leaderboard</h2>
                <div id="leaderboard">
                    <div class="leaderboard-row">
                        <strong>Agent</strong>
                        <strong>Wins</strong>
                        <strong>Losses</strong>
                        <strong>Busts</strong>
                    </div>
                    <div id="leaderboard-list"></div>
                </div>
            </div>

            <div class="card">
                <h2>üìù Action Log</h2>
                <ul id="actionLog" class="action-log"></ul>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = window.location.origin;

        async function updateLeaderboard() {
            try {
                const response = await fetch(`${BASE_URL}/api/leaderboard`);
                const agents = await response.json();
                
                const list = document.getElementById('leaderboard-list');
                if (agents && agents.length > 0) {
                    list.innerHTML = agents.map((agent, idx) => `
                        <div class="leaderboard-row">
                            <div><span style="color: #fbbf24;">#${idx + 1}</span> ${agent.name}</div>
                            <div style="color: #4ade80;">${agent.wins}</div>
                            <div style="color: #f87171;">${agent.losses}</div>
                            <div style="color: #fb923c;">${agent.busts}</div>
                        </div>
                    `).join('');
                } else {
                    list.innerHTML = '<div style="padding: 10px; color: #888;">No agents yet. Register one!</div>';
                }
            } catch (error) {
                console.error('Leaderboard error:', error);
            }
        }

        async function updateActionLog() {
            try {
                const response = await fetch(`${BASE_URL}/api/tables/main/log?limit=50`);
                const actions = await response.json();
                
                const logEl = document.getElementById('actionLog');
                if (actions && actions.length > 0) {
                    logEl.innerHTML = actions.map(action => {
                        const time = new Date(action.timestamp).toLocaleTimeString();
                        return `
                            <li class="action-item">
                                <span class="agent">${action.name}</span>
                                <span class="action">${action.action_type.toUpperCase()}</span>
                                (${action.hand_value})
                                ${action.result ? `<span class="result-${action.result}">${action.result.toUpperCase()}</span>` : ''}
                                <span class="time">${time}</span>
                            </li>
                        `;
                    }).join('');
                } else {
                    logEl.innerHTML = '<li class="action-item" style="color: #888;">No actions yet</li>';
                }
            } catch (error) {
                console.error('Log error:', error);
            }
        }

        // Update every 2 seconds
        setInterval(() => {
            updateLeaderboard();
            updateActionLog();
        }, 2000);

        // Initial load
        updateLeaderboard();
        updateActionLog();
    </script>
</body>
</html>
